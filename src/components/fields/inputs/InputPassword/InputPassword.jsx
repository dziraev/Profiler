import React, { useState } from 'react';
import { useField } from 'formik';
import classNames from 'classnames/bind';
import stylesInputPassword from './InputPassword.module.scss';
import styles from '../Input.module.scss';

const cx = classNames.bind(styles);

export const InputPassword = ({ adaptive = true, ...props }) => {
  const [showPassword, setShowPassword] = useState(false);
  const [active, setActive] = useState(false);
  const [field, meta] = useField(props);
  const hasError = !!(meta.error && meta.touched);

  function handleBlur(e) {
    field.onBlur(e);
    setActive(false);
  }

  function handleFocus(e) {
    setActive(true);
  }

  return (
    <div className={styles.inputContainer}>
      <input
        {...props}
        {...field}
        className={cx(styles.input, styles.input_paddingRight, {
          input__error: hasError && typeof meta.error === 'string',
          input_adaptive: adaptive
        })}
        onFocus={handleFocus}
        onBlur={handleBlur}
        type={showPassword ? 'text' : 'password'}
        placeholder={!active ? 'Password' : 'Enter your password'}
      />
      <div
        className={stylesInputPassword.password}
        onClick={() => {
          setShowPassword(!showPassword);
        }}
      >
        {showPassword ? (
          <svg
            width='24'
            height='24'
            viewBox='0 0 24 24'
            fill='none'
            xmlns='http://www.w3.org/2000/svg'
          >
            <path
              fillRule='evenodd'
              clipRule='evenodd'
              d='M3.00451 9.37746C5.2246 6.16789 8.4645 4.24976 12.0002 4.24976C15.536 4.24976 18.776 6.16809 20.9961 9.37796C21.5157 10.1272 21.7502 11.0851 21.7502 11.9998C21.7502 12.9146 21.5156 13.8728 20.9958 14.622C18.7757 17.8316 15.5358 19.7498 12.0002 19.7498C8.46432 19.7498 5.22427 17.8314 3.00417 14.6216L3.621 14.1949L3.00486 14.6225C2.48479 13.8732 2.25016 12.9148 2.25016 11.9998C2.25016 11.0849 2.48468 10.1267 3.00451 9.37746ZM12.0002 5.74976C9.04238 5.74976 6.23031 7.35046 4.23784 10.2312L4.23715 10.2322C3.92943 10.6756 3.75016 11.3161 3.75016 11.9998C3.75016 12.6835 3.92943 13.3239 4.23715 13.7673L4.23784 13.7683C6.23031 16.6491 9.04238 18.2498 12.0002 18.2498C14.9579 18.2498 17.77 16.6491 19.7625 13.7683L19.7632 13.7673C20.0709 13.3239 20.2502 12.6835 20.2502 11.9998C20.2502 11.3161 20.0709 10.6756 19.7632 10.2322L19.7625 10.2312C17.77 7.35046 14.9579 5.74976 12.0002 5.74976ZM12.0002 9.72559C10.5329 9.72559 9.45736 10.8011 9.45736 12.004C9.45736 13.2068 10.5329 14.2824 12.0002 14.2824C13.4674 14.2824 14.543 13.2068 14.543 12.004C14.543 10.8011 13.4674 9.72559 12.0002 9.72559ZM7.95736 12.004C7.95736 9.85698 9.82512 8.22559 12.0002 8.22559C14.1752 8.22559 16.043 9.85698 16.043 12.004C16.043 14.151 14.1752 15.7824 12.0002 15.7824C9.82512 15.7824 7.95736 14.151 7.95736 12.004Z'
              fill='#25225D'
            />
          </svg>
        ) : (
          <svg
            width='24'
            height='24'
            viewBox='0 0 24 24'
            fill='none'
            xmlns='http://www.w3.org/2000/svg'
          >
            <path
              fillRule='evenodd'
              clipRule='evenodd'
              d='M1.66719 17.7477C1.34079 18.0027 1.28292 18.474 1.53793 18.8004C1.79295 19.1268 2.26428 19.1847 2.59069 18.9297L21.1089 4.46165C21.4353 4.20663 21.4932 3.7353 21.2382 3.40889C20.9832 3.08249 20.5119 3.02462 20.1854 3.27963L17.112 5.68089C15.551 4.7551 13.8143 4.24984 11.9997 4.24984C8.46402 4.24984 5.22412 6.16797 3.00403 9.37754C2.4842 10.1268 2.24968 11.0849 2.24968 11.9998C2.24968 12.9147 2.4842 13.8729 3.00403 14.6221C3.32056 15.0797 3.65782 15.5111 4.01371 15.9144L1.66719 17.7477ZM5.19779 14.9893L8.03853 12.7698C7.98506 12.5237 7.95688 12.2678 7.95688 12.0041C7.95688 9.85706 9.82465 8.22567 11.9997 8.22567C12.5274 8.22567 13.0371 8.32172 13.5064 8.49788L15.8269 6.68494C14.6208 6.07115 13.3249 5.74984 11.9997 5.74984C9.0419 5.74984 6.22983 7.35054 4.23736 10.2313L4.23667 10.2323C3.92895 10.6757 3.74968 11.3161 3.74968 11.9998C3.74968 12.6835 3.92895 13.324 4.23667 13.7674L4.23736 13.7684C4.53945 14.2051 4.86037 14.6125 5.19779 14.9893ZM11.934 9.72639C10.6512 9.75462 9.6808 10.6073 9.49078 11.6352L11.934 9.72639Z'
              fill='#25225D'
            />
            <path
              d='M7.09305 18.4377C6.64193 18.1833 6.62391 17.5599 7.03203 17.241C7.28688 17.0419 7.63765 17.0264 7.92121 17.1819C9.19775 17.8821 10.582 18.2498 11.9997 18.2498C14.9574 18.2498 17.7695 16.6491 19.762 13.7684L19.7627 13.7674C20.0704 13.324 20.2497 12.6835 20.2497 11.9998C20.2497 11.3161 20.0704 10.6757 19.7627 10.2323L19.762 10.2313C19.4771 9.8194 19.1755 9.43367 18.859 9.07505C18.5611 8.73745 18.5889 8.21184 18.9436 7.93464C19.2406 7.70264 19.6659 7.72793 19.9174 8.00854C20.2986 8.43386 20.6589 8.89109 20.9957 9.37804C21.5153 10.1272 21.7497 11.0851 21.7497 11.9998C21.7497 12.9147 21.5152 13.8729 20.9953 14.6221C18.7752 17.8317 15.5353 19.7498 11.9997 19.7498C10.2644 19.7498 8.60028 19.2878 7.09305 18.4377Z'
              fill='#25225D'
            />
            <path
              d='M10.8121 15.6158C10.2559 15.456 10.2115 14.757 10.6675 14.4007C10.8952 14.2228 11.1972 14.1844 11.4815 14.2362C11.6476 14.2665 11.8207 14.2825 11.9997 14.2825C13.467 14.2825 14.5425 13.2069 14.5425 12.0041L14.5423 11.9802C14.5384 11.6471 14.6336 11.302 14.8961 11.097C15.3077 10.7753 15.9172 10.9237 15.9985 11.4398C16.0275 11.6232 16.0425 11.8115 16.0425 12.0041C16.0425 14.1511 14.1747 15.7825 11.9997 15.7825C11.5894 15.7825 11.1901 15.7244 10.8121 15.6158Z'
              fill='#25225D'
            />
          </svg>
        )}
      </div>
      {hasError && (
        <div className={styles.error}>
          {meta.error}
          <svg
            width='18'
            height='18'
            viewBox='0 0 18 18'
            fill='none'
            xmlns='http://www.w3.org/2000/svg'
          >
            <path
              d='M9 5.5C9.27614 5.5 9.5 5.72386 9.5 6V9.75C9.5 10.0261 9.27614 10.25 9 10.25C8.72386 10.25 8.5 10.0261 8.5 9.75V6C8.5 5.72386 8.72386 5.5 9 5.5Z'
              fill='#D40000'
            />
            <path
              d='M8.99609 11.25C8.58188 11.25 8.24609 11.5858 8.24609 12C8.24609 12.4142 8.58188 12.75 8.99609 12.75H9.00283C9.41704 12.75 9.75283 12.4142 9.75283 12C9.75283 11.5858 9.41704 11.25 9.00283 11.25H8.99609Z'
              fill='#D40000'
            />
            <path
              fillRule='evenodd'
              clipRule='evenodd'
              d='M1 9C1 4.59886 4.59886 1 9 1C13.4011 1 17 4.59886 17 9C17 13.4011 13.4011 17 9 17C4.59886 17 1 13.4011 1 9ZM9 2C5.15114 2 2 5.15114 2 9C2 12.8489 5.15114 16 9 16C12.8489 16 16 12.8489 16 9C16 5.15114 12.8489 2 9 2Z'
              fill='#D40000'
            />
          </svg>
        </div>
      )}
    </div>
  );
};
